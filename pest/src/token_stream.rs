use futures::Poll;
use futures::stream::Stream;
use futures::sync::mpsc::Receiver;

use super::token::Token;

/// A `Stream` of `Token` objects generated by the `Parser`.
pub struct TokenStream<Rule> {
    receiver: Receiver<Token<Rule>>
}

impl<Rule> TokenStream<Rule> {
    /// Creates a new `TokenStream` from a `Token`-generating `Receiver`.
    ///
    /// # Examples
    ///
    /// ```no_run
    /// # extern crate futures;
    /// # use futures::sync::mpsc::channel;
    /// # use pest::TokenStream;
    /// let (_, r) = channel();
    ///
    /// let stream = TokenStream::new(r);
    /// ```
    pub fn new(receiver: Receiver<Token<Rule>>) -> TokenStream<Rule> {
        TokenStream {
            receiver: receiver
        }
    }
}

impl<Rule> Stream for TokenStream<Rule> {
    type Item  = Token<Rule>;
    type Error = ();

    fn poll(&mut self) -> Poll<Option<Token<Rule>>, ()> {
        self.receiver.poll()
    }
}
